<html>
  <body>

    <form id="novel_form" action="http://hollyclown.web.fc2.com/natsume_replacetool.html" method="post" >
      <textarea name="input-text" cols="150" rows="10">ここに夏目くんの台詞を変換したいテキストをまるっと貼り付けてください。</textarea><br>
      <input type="submit" value="変換" >
    </form>

    <iframe id="my_iframe" name="form_response" style="display:none;" ></iframe>

    <script type="text/javascript">
    <!--

	// ------------------------------------------------------------
	// インラインフレーム内の読み込み完了を監視するコンストラクタ
	// ------------------------------------------------------------
	function IFrameElementObserverContentLoaded (iframe,callback){

		// ------------------------------------------------------------
		// 初期化
		// ------------------------------------------------------------
		var handler;
		var iframe_window = iframe.contentWindow;
		if(iframe.addEventListener){
			handler = function (e){
				callback();
			};
			iframe.addEventListener("load" , handler);
		}else if(iframe.attachEvent){
			handler = function (e){
				try {
					if(iframe_window.document.readyState === "complete"){
						callback();
					}
				}catch(e){
				}
			};
			iframe.attachEvent("onreadystatechange" , handler);
		}

		// ------------------------------------------------------------
		// 開放する
		// ------------------------------------------------------------
		this.release = function(){
			if(!handler) return;
			if(iframe.removeEventListener){
				iframe.removeEventListener("load" , handler);
			}else if(iframe.detachEvent){
				iframe.detachEvent("onreadystatechange" , handler);
			}
			handler = null;
		};
	}

	// ------------------------------------------------------------
	// エレメントの内容を文字列として取得する関数
	// ------------------------------------------------------------
	function ElementGetTextContent(element){
		if(element.textContent !== undefined){
			return element.textContent;
		}
		if(element.innerText !== undefined){
			return element.innerText;
		}

		return "";
	}


	// ------------------------------------------------------------
	// 各要素を取得する
	// ------------------------------------------------------------
	// "novel_form" という ID 属性のエレメントを取得する
	var form = document.getElementById("novel_form");

	// "my_iframe" という ID 属性のエレメントを取得する
	var iframe = document.getElementById("my_iframe");

	// ------------------------------------------------------------
	// フォームの設定を変更する
	// ------------------------------------------------------------
	// アクセス先を変更する
	form.action = "http://hollyclown.web.fc2.com/natsume_replacetool.html?type=text";

	// ターゲットウィンドウを設定する
	form.target = "form_response";

	// ------------------------------------------------------------
	// サブミット直前に実行されるイベント
	// ------------------------------------------------------------
	form.onsubmit = function (e){

		// ------------------------------------------------------------
		// インラインフレーム内の読み込み完了を監視する
		// ------------------------------------------------------------
		var observer = new IFrameElementObserverContentLoaded (iframe , function(){

			// ------------------------------------------------------------
			// 監視を終了する（ここでは１回だけ監視する）
			// ------------------------------------------------------------
			observer.release();
			observer = null;

			// ------------------------------------------------------------
			// インラインフレーム内のコンテンツを取得する
			// ------------------------------------------------------------
			try{
				// インラインフレーム内の Window オブジェクトを取得する
				var iframe_window = iframe.contentWindow;

				// Document オブジェクトを取得する
				var iframe_document = iframe_window.document;

				// HTMLHtmlElement オブジェクトを取得する
				var html_element = iframe_document.documentElement;

				// 自身を含む HTML 文字列を取得する
				var str_html = html_element.outerHTML;
				
				// エレメントの内容をテキストとして取得する
				var str_text = ElementGetTextContent(html_element);

				// 出力テスト
				console.log(str_html);
				console.log(str_text);

			}catch(e){

				// 出力テスト（セキュリティエラーなど）
				console.log(e);
			}

		});

	};

    //-->
    </script>

  </body>
</html>